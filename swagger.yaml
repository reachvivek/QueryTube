openapi: 3.0.3
info:
  title: QueryTube API
  description: |
    AI-powered video Q&A system with semantic search capabilities.
    Transform any video into an intelligent chatbot.
  version: 1.0.0
  contact:
    name: Vivek Kumar Singh
    url: https://github.com/reachvivek
  license:
    name: Custom Proprietary License
    url: https://github.com/reachvivek/QueryTube/blob/main/LICENSE.md

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://querytube.app/api
    description: Production server

tags:
  - name: Video
    description: Video management operations
  - name: Transcript
    description: Transcript processing operations
  - name: Embeddings
    description: Vector embedding generation
  - name: Q&A
    description: Question answering with RAG
  - name: Dashboard
    description: Dashboard and analytics

paths:
  /validate-video:
    get:
      tags:
        - Video
      summary: Validate YouTube video URL
      description: Validates a YouTube URL and returns video metadata
      parameters:
        - name: url
          in: query
          required: true
          schema:
            type: string
            example: https://www.youtube.com/watch?v=dQw4w9WgXcQ
          description: YouTube video URL
      responses:
        '200':
          description: Video validated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  video:
                    $ref: '#/components/schemas/VideoMetadata'
        '400':
          description: Invalid URL format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /videos:
    post:
      tags:
        - Video
      summary: Create new video record
      description: Creates a new video entry in the database
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVideoRequest'
      responses:
        '200':
          description: Video created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  video:
                    $ref: '#/components/schemas/Video'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /videos/{id}:
    get:
      tags:
        - Video
      summary: Get video by ID
      description: Retrieves video details with chunks and analytics
      parameters:
        - $ref: '#/components/parameters/VideoId'
      responses:
        '200':
          description: Video retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  video:
                    $ref: '#/components/schemas/VideoWithRelations'
        '404':
          description: Video not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      tags:
        - Video
      summary: Update video
      description: Updates video metadata, transcript, and chunks
      parameters:
        - $ref: '#/components/parameters/VideoId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVideoRequest'
      responses:
        '200':
          description: Video updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  video:
                    $ref: '#/components/schemas/Video'

    delete:
      tags:
        - Video
      summary: Delete video
      description: Deletes video, chunks (DB + Pinecone), and analytics
      parameters:
        - $ref: '#/components/parameters/VideoId'
      responses:
        '200':
          description: Video deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Video deleted successfully
                  vectorsDeleted:
                    type: integer
                    example: 30

  /process-transcript:
    post:
      tags:
        - Transcript
      summary: Extract and process video transcript
      description: Extracts transcript from YouTube captions or uses Whisper AI
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - videoId
                - url
              properties:
                videoId:
                  type: string
                  format: uuid
                  example: 550e8400-e29b-41d4-a716-446655440000
                url:
                  type: string
                  example: https://www.youtube.com/watch?v=dQw4w9WgXcQ
      responses:
        '200':
          description: Transcript processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranscriptResponse'

  /embeddings:
    post:
      tags:
        - Embeddings
      summary: Generate vector embeddings
      description: Generates semantic embeddings using Mistral AI or OpenAI
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - chunks
              properties:
                chunks:
                  type: array
                  items:
                    $ref: '#/components/schemas/Chunk'
                  example:
                    - text: Example transcript text
                      startTime: 0
                      endTime: 90
                model:
                  type: string
                  example: mistral-embed
                  enum:
                    - mistral-embed
                    - text-embedding-3-small
                provider:
                  type: string
                  example: mistral
                  enum:
                    - mistral
                    - openai
      responses:
        '200':
          description: Embeddings generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingsResponse'

  /upload-vectors:
    post:
      tags:
        - Embeddings
      summary: Upload vectors to Pinecone
      description: Uploads embeddings to Pinecone and generates AI summary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - videoId
                - chunks
                - embeddings
              properties:
                videoId:
                  type: string
                  format: uuid
                chunks:
                  type: array
                  items:
                    $ref: '#/components/schemas/Chunk'
                embeddings:
                  type: array
                  items:
                    type: array
                    items:
                      type: number
                embeddingProvider:
                  type: string
                  example: mistral
                metadata:
                  type: object
                  properties:
                    title:
                      type: string
                    youtubeUrl:
                      type: string
                    language:
                      type: string
                    uploader:
                      type: string
      responses:
        '200':
          description: Vectors uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  vectorsUploaded:
                    type: integer
                    example: 30
                  summary:
                    type: string
                    example: This video explains quantum mechanics fundamentals.

  /generate-summary:
    post:
      tags:
        - Transcript
      summary: Generate AI summary
      description: Generates AI-powered summary of video content
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - videoId
              properties:
                videoId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Summary generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  summary:
                    type: string
                    example: This video explains the fundamentals of machine learning.
                  fromCache:
                    type: boolean
                    example: false

  /qa:
    post:
      tags:
        - Q&A
      summary: Ask question about video
      description: RAG-based question answering with semantic search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionRequest'
      responses:
        '200':
          description: Answer generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnswerResponse'

  /dashboard:
    get:
      tags:
        - Dashboard
      summary: Get dashboard data
      description: Returns statistics and recent videos
      responses:
        '200':
          description: Dashboard data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardResponse'

components:
  parameters:
    VideoId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Video UUID

  schemas:
    VideoMetadata:
      type: object
      properties:
        id:
          type: string
          example: dQw4w9WgXcQ
        title:
          type: string
          example: "Rick Astley - Never Gonna Give You Up"
        duration:
          type: integer
          example: 213
          description: Duration in seconds
        durationFormatted:
          type: string
          example: "3:33"
        thumbnail:
          type: string
          format: uri
          example: https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg
        uploader:
          type: string
          example: Rick Astley
        description:
          type: string
          example: The official video for Never Gonna Give You Up
        url:
          type: string
          format: uri
          example: https://www.youtube.com/watch?v=dQw4w9WgXcQ

    Video:
      type: object
      properties:
        id:
          type: string
          format: uuid
        youtubeUrl:
          type: string
          format: uri
        youtubeId:
          type: string
        title:
          type: string
        description:
          type: string
        duration:
          type: integer
        durationFormatted:
          type: string
        thumbnail:
          type: string
          format: uri
        uploader:
          type: string
        language:
          type: string
          example: en
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
        errorMessage:
          type: string
          nullable: true
        transcriptSource:
          type: string
          enum:
            - youtube-captions
            - whisper-api
            - uploaded-file
          nullable: true
        transcript:
          type: string
          nullable: true
        summary:
          type: string
          nullable: true
        uploadedAt:
          type: string
          format: date-time
        processedAt:
          type: string
          format: date-time
          nullable: true

    VideoWithRelations:
      allOf:
        - $ref: '#/components/schemas/Video'
        - type: object
          properties:
            chunks:
              type: array
              items:
                $ref: '#/components/schemas/ChunkWithVectorId'
            analytics:
              type: array
              items:
                $ref: '#/components/schemas/Analytics'

    Chunk:
      type: object
      properties:
        chunkIndex:
          type: integer
          example: 0
        text:
          type: string
          example: In this video, we'll explore quantum mechanics...
        startTime:
          type: integer
          example: 0
          description: Start time in seconds
        endTime:
          type: integer
          example: 90
          description: End time in seconds

    ChunkWithVectorId:
      allOf:
        - $ref: '#/components/schemas/Chunk'
        - type: object
          properties:
            id:
              type: string
              format: uuid
            vectorId:
              type: string
              nullable: true
            embeddingProvider:
              type: string
              nullable: true
              example: mistral
            timestamp:
              type: string
              example: "0:00"
            createdAt:
              type: string
              format: date-time

    Analytics:
      type: object
      properties:
        id:
          type: string
          format: uuid
        videoId:
          type: string
          format: uuid
        question:
          type: string
        answer:
          type: string
        responseTime:
          type: number
          format: float
          example: 1.2
        provider:
          type: string
          example: groq
          enum:
            - groq
            - openai
            - claude
        model:
          type: string
          example: llama-3.3-70b-versatile
        chunksUsed:
          type: integer
          example: 5
        timestamp:
          type: string
          format: date-time

    CreateVideoRequest:
      type: object
      required:
        - youtubeUrl
        - title
        - duration
        - durationFormatted
      properties:
        youtubeUrl:
          type: string
          format: uri
        youtubeId:
          type: string
        title:
          type: string
        description:
          type: string
        duration:
          type: integer
        durationFormatted:
          type: string
        thumbnail:
          type: string
          format: uri
        uploader:
          type: string

    UpdateVideoRequest:
      type: object
      properties:
        transcript:
          type: string
        transcriptSource:
          type: string
        language:
          type: string
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
        processedAt:
          type: string
          format: date-time
        chunks:
          type: array
          items:
            $ref: '#/components/schemas/Chunk'

    TranscriptResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        transcript:
          type: string
        method:
          type: string
          enum:
            - youtube-captions
            - whisper-api
          example: youtube-captions
        language:
          type: string
          example: en
        chunks:
          type: array
          items:
            $ref: '#/components/schemas/Chunk'
        stats:
          type: object
          properties:
            totalChunks:
              type: integer
              example: 30
            chunkSize:
              type: integer
              example: 90
            overlap:
              type: integer
              example: 10

    EmbeddingsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        embeddings:
          type: array
          items:
            type: array
            items:
              type: number
        model:
          type: string
          example: mistral-embed
        provider:
          type: string
          example: mistral
        dimensions:
          type: integer
          example: 1024
        totalChunks:
          type: integer
          example: 30

    QuestionRequest:
      type: object
      required:
        - question
      properties:
        question:
          type: string
          example: What is quantum entanglement?
        videoId:
          type: string
          format: uuid
          nullable: true
          description: Filter to specific video, null for all videos
        provider:
          type: string
          enum:
            - groq
            - openai
            - claude
          example: groq
        model:
          type: string
          example: llama-3.3-70b-versatile
        systemPrompt:
          type: string
          nullable: true
        topK:
          type: integer
          example: 5
          minimum: 1
          maximum: 20

    AnswerResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        answer:
          type: string
          example: Quantum entanglement is a phenomenon where...
        chunks:
          type: array
          items:
            type: object
            properties:
              text:
                type: string
              score:
                type: number
                format: float
                example: 0.89
              timestamp:
                type: string
                example: "12:34"
              title:
                type: string
              videoId:
                type: string
        responseTime:
          type: number
          format: float
          example: 1.2
        model:
          type: string
          example: llama-3.3-70b-versatile

    DashboardResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        stats:
          type: object
          properties:
            totalVideos:
              type: integer
              example: 15
            totalChunks:
              type: integer
              example: 450
            storageUsed:
              type: string
              example: "125 MB"
            questionsAnswered:
              type: integer
              example: 234
        videos:
          type: array
          items:
            $ref: '#/components/schemas/DashboardVideo'

    DashboardVideo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        url:
          type: string
          format: uri
        youtubeId:
          type: string
        status:
          type: string
        progress:
          type: integer
          example: 100
        duration:
          type: string
          example: "45:23"
        chunks:
          type: integer
          example: 30
        uploadedAt:
          type: string
          example: "2026-01-17"
        language:
          type: string
          example: en

    Error:
      type: object
      properties:
        error:
          type: string
          example: Invalid request
        message:
          type: string
          example: Detailed error message
